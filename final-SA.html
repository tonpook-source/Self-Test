<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>แบบทดสอบวิชาการวิเคราะห์และออกแบบระบบ (31909-1005)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Prompt -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; }
        
        /* Custom Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out forwards;
        }

        /* Choice Button Effects */
        .choice-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .choice-btn:hover {
            transform: translateX(4px);
            border-color: #60a5fa; /* blue-400 */
            background-color: #eff6ff; /* blue-50 */
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.1);
        }
        .choice-btn.selected {
            background: linear-gradient(to right, #eff6ff, #ffffff);
            border-color: #2563eb;
            color: #1e3a8a;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }
        .choice-btn.correct { background-color: #d1fae5; border-color: #059669; color: #064e3b; }
        .choice-btn.wrong { background-color: #fee2e2; border-color: #dc2626; color: #7f1d1d; }
        
        /* Custom Scrollbar */
        .nav-scroll::-webkit-scrollbar { width: 6px; }
        .nav-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); }
        .nav-scroll::-webkit-scrollbar-thumb { background-color: #94a3b8; border-radius: 4px; }
        .nav-scroll::-webkit-scrollbar-thumb:hover { background-color: #64748b; }

        /* Glass Effect Classes */
        .glass-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 8px 10px -6px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body class="bg-slate-900 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-blue-600 via-slate-900 to-black text-gray-800 h-screen flex flex-col overflow-hidden selection:bg-blue-500 selection:text-white">

    <!-- Header (Glassmorphism) -->
    <header class="glass-header text-white p-4 shadow-lg flex justify-between items-center z-20 shrink-0 border-b border-white/10">
        <div class="flex items-center gap-3">
            <div>
                <h1 class="text-lg md:text-xl font-bold tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-blue-100 to-cyan-100 drop-shadow-sm">
                    การวิเคราะห์และออกแบบระบบ
                </h1>
                <p class="text-xs text-blue-200 font-light tracking-wider">31909-1005 | ครูธนพล อ่อนพุก</p>
            </div>
        </div>
        <div class="text-right flex items-center gap-4">
            <div class="hidden md:block text-right">
                <div class="text-[10px] text-blue-300 uppercase tracking-widest font-semibold">Time Remaining</div>
                <div class="font-mono text-xl font-bold text-cyan-300 tabular-nums drop-shadow-[0_0_10px_rgba(34,211,238,0.5)]" id="timer">00:00</div>
            </div>
            <!-- Mobile Menu Toggle (Visible only on small screens) -->
            <button onclick="toggleSidebar()" class="md:hidden text-white hover:text-cyan-300 transition">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="flex flex-1 overflow-hidden relative">
        
        <!-- Main Content (Question Area) -->
        <main class="flex-1 p-4 md:p-6 overflow-y-auto relative z-10" id="quiz-container">
            
            <!-- Background Decoration -->
            <div class="fixed top-20 left-10 w-72 h-72 bg-blue-600 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob pointer-events-none"></div>
            <div class="fixed top-40 right-10 w-72 h-72 bg-cyan-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000 pointer-events-none"></div>

            <div class="max-w-4xl mx-auto glass-panel rounded-2xl p-6 md:p-10 min-h-[500px] border border-white/50 relative">
                
                <!-- Start Screen -->
                <div id="start-screen" class="text-center py-6 animate-fade-in">
                    <div class="w-20 h-20 bg-gradient-to-tr from-blue-600 to-cyan-400 rounded-full flex items-center justify-center mx-auto mb-4 shadow-xl shadow-blue-500/40">
                        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold mb-2 text-slate-800">วิชา การวิเคราะห์และออกแบบระบบ</h2>
                    <p class="text-slate-600 font-medium">รหัสวิชา 31909-1005</p>
                    <p class="mb-6 text-slate-500 text-sm">ครูผู้สอน: ครูธนพล อ่อนพุก</p>
                    
                    <!-- Registration Form -->
                    <div class="bg-white/60 backdrop-blur-sm rounded-xl p-6 max-w-lg mx-auto mb-8 border border-white/40 shadow-sm text-left">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-slate-600 text-sm font-bold mb-1">ชื่อ-นามสกุล <span class="text-red-500">*</span></label>
                                <input type="text" id="student-name" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none bg-white/80" placeholder="เช่น นายสมชาย ใจดี">
                            </div>
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-slate-600 text-sm font-bold mb-1">ระดับชั้น <span class="text-red-500">*</span></label>
                                    <div class="relative">
                                        <select id="student-class" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none bg-white/80 appearance-none cursor-pointer">
                                            <option value="">-- เลือกห้อง --</option>
                                            <option value="ส.2/1ทค.">ส.2/1ทค.</option>
                                            <option value="ส.2/2 ทค.">ส.2/2 ทค.</option>
                                        </select>
                                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                            <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-slate-600 text-sm font-bold mb-1">เลขที่ <span class="text-red-500">*</span></label>
                                    <input type="number" id="student-number" class="w-full px-4 py-2.5 rounded-lg border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all outline-none bg-white/80" placeholder="เช่น 15">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button onclick="startQuiz()" class="group relative inline-flex items-center justify-center px-8 py-3 font-bold text-white transition-all duration-200 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-600 hover:shadow-lg hover:shadow-blue-500/40 hover:-translate-y-1 w-full max-w-xs">
                        <span class="mr-2 text-lg">เริ่มทำแบบทดสอบ</span>
                        <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path></svg>
                    </button>
                </div>

                <!-- Question Screen -->
                <div id="question-screen" class="hidden h-full flex flex-col">
                    <div class="flex justify-between items-center mb-6 pb-4 border-b border-slate-100">
                        <div class="flex items-center gap-2">
                            <span class="text-slate-400 text-sm font-medium uppercase tracking-wider">Question</span>
                            <span class="text-3xl font-bold text-blue-600" id="current-q-num">1</span>
                            <span class="text-slate-400 text-xl font-light">/ 60</span>
                        </div>
                        <span class="text-xs font-semibold bg-gradient-to-r from-blue-100 to-cyan-100 text-blue-700 px-3 py-1.5 rounded-full shadow-sm" id="question-category">
                            หมวดหมู่
                        </span>
                    </div>

                    <div class="flex-1">
                        <h3 class="text-xl md:text-2xl font-semibold mb-8 text-slate-800 leading-relaxed" id="question-text">
                            คำถาม...
                        </h3>

                        <div class="grid gap-3" id="choices-container">
                            <!-- Choices injected here -->
                        </div>
                    </div>

                    <div class="flex justify-between mt-10 pt-6 border-t border-slate-100">
                        <button onclick="prevQuestion()" id="btn-prev" class="px-6 py-2.5 rounded-xl bg-white border border-slate-200 text-slate-600 hover:bg-slate-50 hover:text-slate-900 font-medium transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 shadow-sm">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            ย้อนกลับ
                        </button>
                        
                        <button onclick="nextQuestion()" id="btn-next" class="px-6 py-2.5 rounded-xl bg-slate-900 text-white hover:bg-slate-800 font-medium transition shadow-lg shadow-slate-900/20 flex items-center gap-2">
                            ถัดไป
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                        </button>
                        
                        <button onclick="submitQuiz()" id="btn-submit" class="hidden px-8 py-2.5 rounded-xl bg-gradient-to-r from-green-500 to-emerald-600 text-white hover:from-green-600 hover:to-emerald-700 font-bold transition shadow-lg shadow-green-500/30 flex items-center gap-2 transform hover:-translate-y-0.5">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            ส่งคำตอบ
                        </button>
                    </div>
                </div>

                <!-- Result Screen -->
                <div id="result-screen" class="hidden text-center py-10 animate-fade-in">
                    <div class="relative inline-block">
                        <div class="absolute inset-0 bg-blue-500 blur-2xl opacity-20 rounded-full"></div>
                        <div class="relative w-24 h-24 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                            <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>
                        </div>
                    </div>
                    
                    <h2 class="text-4xl font-bold mb-2 text-slate-800">ยอดเยี่ยม!</h2>
                    <p class="text-slate-500 mb-6">คุณทำแบบทดสอบครบแล้ว</p>

                    <!-- Student Info Display -->
                    <div class="bg-white/80 rounded-xl p-5 mb-6 border border-slate-200 inline-block text-left shadow-sm min-w-[300px]">
                        <h3 class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 text-center border-b pb-2">ข้อมูลผู้เข้าสอบ</h3>
                        <div class="text-slate-700 space-y-1" id="result-student-info">
                            <!-- Info will be injected here -->
                        </div>
                        <div id="save-status" class="mt-4 pt-3 border-t border-slate-100 text-center text-sm font-medium">
                            <!-- Saving status will appear here -->
                        </div>
                    </div>
                    
                    <div class="bg-slate-50 rounded-2xl p-6 max-w-sm mx-auto mb-8 border border-slate-100 shadow-inner">
                        <div class="text-sm text-slate-500 uppercase tracking-widest font-semibold mb-2">คะแนนรวม</div>
                        <div class="text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-br from-blue-600 to-cyan-500 mb-2" id="score-display">0</div>
                        <div class="text-slate-400 font-medium" id="score-percent">0%</div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row justify-center gap-4">
                        <button onclick="location.reload()" class="px-6 py-3 rounded-xl bg-white border border-slate-200 text-slate-700 hover:bg-slate-50 font-medium shadow-sm transition">
                            ทำอีกครั้ง
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Sidebar Navigation (Modern Glass Style) -->
        <aside class="w-20 md:w-72 bg-white/95 backdrop-blur-xl border-l border-white/20 shadow-2xl flex flex-col shrink-0 hidden md:flex transition-all duration-300 z-20" id="sidebar">
            <div class="p-5 bg-gradient-to-b from-white to-slate-50 border-b border-slate-100">
                <h3 class="font-bold text-slate-800 hidden md:block">Navigator</h3>
                <span class="md:hidden text-center block text-xs font-bold text-slate-500">Q. No</span>
            </div>
            
            <div class="flex-1 overflow-y-auto p-3 nav-scroll bg-slate-50/50">
                <div class="grid grid-cols-1 md:grid-cols-5 gap-2" id="nav-grid">
                    <!-- Nav buttons generated by JS -->
                </div>
            </div>
            
            <div class="p-4 border-t border-slate-100 bg-white">
                <div class="grid grid-cols-2 gap-2 text-[10px] md:text-xs text-slate-500">
                    <div class="flex items-center justify-center md:justify-start gap-2">
                        <div class="w-2.5 h-2.5 bg-blue-500 rounded-full shadow-sm shadow-blue-500/50"></div> <span class="hidden md:inline">ทำแล้ว</span>
                    </div>
                    <div class="flex items-center justify-center md:justify-start gap-2">
                        <div class="w-2.5 h-2.5 bg-white border border-slate-300 rounded-full"></div> <span class="hidden md:inline">ยังไม่ทำ</span>
                    </div>
                    <div class="flex items-center justify-center md:justify-start gap-2 col-span-2 mt-1">
                        <div class="w-2.5 h-2.5 bg-blue-100 ring-2 ring-blue-500 rounded-full"></div> <span class="hidden md:inline">กำลังทำ</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Custom Modal (Replcae Alert/Confirm) -->
        <div id="custom-modal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden backdrop-blur-sm">
            <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4 shadow-2xl transform scale-100 transition-all">
                <h3 class="text-xl font-bold text-slate-800 mb-3" id="modal-title">แจ้งเตือน</h3>
                <p class="text-slate-600 mb-6" id="modal-message">ข้อความ...</p>
                <div class="flex justify-end gap-3">
                    <button id="modal-cancel" class="px-4 py-2 rounded-lg text-slate-600 hover:bg-slate-100 hidden">ยกเลิก</button>
                    <button id="modal-confirm" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-md">ตกลง</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ******************************************************************
        // ตั้งค่า Google Sheet
        // ******************************************************************
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzXGw_HSPurQ8sizsnH6689Jf_ne85HnM6K7ojGXrypRHq9_0qcr9Bqddty26WWvCs/exec"; 
        // ******************************************************************

        // Data Structure for Questions (Balanced: A=15, B=15, C=15, D=15)
        const quizData = [
            // --- 1. องค์ประกอบของระบบคอมพิวเตอร์ (1-6) ---
            { category: "องค์ประกอบคอมพิวเตอร์", q: "ข้อใด **ไม่ใช่** องค์ประกอบหลักของระบบคอมพิวเตอร์?", options: ["Atmosphere (บรรยากาศ)", "Hardware (ฮาร์ดแวร์)", "Software (ซอฟต์แวร์)", "Peopleware (บุคลากร)"], ans: 0 },
            { category: "องค์ประกอบคอมพิวเตอร์", q: "อุปกรณ์ในข้อใดจัดอยู่ในหน่วยรับข้อมูล (Input Unit)?", options: ["จอภาพ (Monitor)", "เมาส์ (Mouse)", "เครื่องพิมพ์ (Printer)", "ลำโพง (Speaker)"], ans: 1 },
            { category: "องค์ประกอบคอมพิวเตอร์", q: "หน่วยประมวลผลกลาง (CPU) เปรียบเสมือนส่วนใดของร่างกายมนุษย์?", options: ["แขนและขา", "หัวใจ", "สมอง", "ดวงตา"], ans: 2 },
            { category: "องค์ประกอบคอมพิวเตอร์", q: "ข้อใดคือหน่วยความจำหลักแบบชั่วคราว ที่ข้อมูลจะหายเมื่อปิดเครื่อง?", options: ["ROM", "Hard Disk", "Flash Drive", "RAM"], ans: 3 },
            { category: "องค์ประกอบคอมพิวเตอร์", q: "อุปกรณ์ใดทำหน้าที่แปลงสัญญาณภาพเพื่อแสดงผลบนหน้าจอ?", options: ["Graphic Card (การ์ดจอ)", "Sound Card (การ์ดเสียง)", "Network Card (การ์ดแลน)", "Mainboard (เมนบอร์ด)"], ans: 0 },
            { category: "องค์ประกอบคอมพิวเตอร์", q: "บุคลากรในข้อใดมีความสำคัญที่สุดในการวิเคราะห์ความต้องการระบบ?", options: ["Programmer (นักเขียนโปรแกรม)", "System Analyst (นักวิเคราะห์ระบบ)", "User (ผู้ใช้งานระบบ)", "Manager (ผู้จัดการโครงการ)"], ans: 1 },
            
            // --- 2. หลักการทำงานของคอมพิวเตอร์ (7-10) ---
            { category: "หลักการทำงาน", q: "วงจรการทำงานพื้นฐานของคอมพิวเตอร์ (IPOS Cycle) ประกอบด้วยอะไรบ้าง?", options: ["Input > Program > Object > System", "Internet > Process > Output > Service", "Input > Process > Output > Storage", "Information > Process > Output > Save"], ans: 2 },
            { category: "หลักการทำงาน", q: "ขั้นตอนการ 'Decode' ในการทำงานของ CPU หมายถึงอะไร?", options: ["การอ่านชุดคำสั่ง", "การประมวลผล", "การจัดเก็บข้อมูล", "การถอดรหัสคำสั่ง"], ans: 3 },
            { category: "หลักการทำงาน", q: "ส่วนประกอบใดใน CPU ทำหน้าที่คำนวณทางคณิตศาสตร์และตรรกะ?", options: ["ALU (Arithmetic Logic Unit)", "CU (Control Unit)", "Register", "Cache"], ans: 0 },
            { category: "หลักการทำงาน", q: "ข้อใดคือลำดับที่ถูกต้องของการประมวลผลคำสั่ง (Machine Cycle)?", options: ["Store > Execute > Decode > Fetch", "Fetch > Decode > Execute > Store", "Decode > Fetch > Store > Execute", "Execute > Fetch > Decode > Store"], ans: 1 },
            
            // --- 3. ระบบและเทคโนโลยีสารสนเทศ (11-20) ---
            { category: "เทคโนโลยีสารสนเทศ", q: "ข้อใดคือความแตกต่างระหว่าง 'ข้อมูล (Data)' และ 'สารสนเทศ (Information)'?", options: ["ข้อมูลคือสิ่งที่ผ่านการประมวลผลแล้ว", "สารสนเทศคือข้อมูลดิบที่ไม่ผ่านการประมวลผล", "ข้อมูลคือข้อเท็จจริงดิบ สารสนเทศคือผลลัพธ์", "ข้อมูลและสารสนเทศมีความหมายเหมือนกันทุกประการ"], ans: 2 },
            { category: "เทคโนโลยีสารสนเทศ", q: "คุณสมบัติที่ดีของสารสนเทศคือข้อใด?", options: ["มีความซับซ้อนเข้าใจยาก", "มีปริมาณมากที่สุดเท่าที่จะทำได้", "มาจากแหล่งข้อมูลเดียวเท่านั้น", "มีความถูกต้องและทันต่อเวลา"], ans: 3 },
            { category: "เทคโนโลยีสารสนเทศ", q: "ระบบสารสนเทศที่ช่วยผู้บริหารระดับสูงในการวางแผนกลยุทธ์ระยะยาวคือ?", options: ["EIS (Executive Information System)", "TPS (Transaction Processing System)", "MIS (Management Information System)", "DSS (Decision Support System)"], ans: 0 },
            { category: "เทคโนโลยีสารสนเทศ", q: "ข้อใดคือความหมายของ 'IoT' (Internet of Things)?", options: ["อินเทอร์เน็ตความเร็วสูง", "อุปกรณ์ที่เชื่อมต่อและสื่อสารผ่านอินเทอร์เน็ต", "เว็บไซต์สำหรับขายสินค้าออนไลน์", "ระบบฐานข้อมูลที่มีขนาดใหญ่มาก"], ans: 1 },
            { category: "เทคโนโลยีสารสนเทศ", q: "การประมวลผลแบบ Cloud Computing มีจุดเด่นคือ?", options: ["ต้องมี Server เป็นของตนเองที่บ้าน", "ระบบสามารถทำงานได้เฉพาะตอนออฟไลน์เท่านั้น", "ใช้ทรัพยากรผ่านเน็ตโดยไม่ต้องลงทุนเครื่องเอง", "มีความปลอดภัยน้อยกว่าระบบคอมพิวเตอร์ทั่วไป"], ans: 2 },
            { category: "เทคโนโลยีสารสนเทศ", q: "ข้อใดจัดเป็นภัยคุกคามทางไซเบอร์ประเภท 'Phishing'?", options: ["ไวรัสคอมพิวเตอร์ทำลายไฟล์", "การโจมตีให้เซิร์ฟเวอร์ล่ม (DDoS)", "การแอบใช้ Wi-Fi ของเพื่อนบ้าน", "สร้างหน้าเว็บปลอมเพื่อหลอกเอาข้อมูลรหัสผ่าน"], ans: 3 },
            { category: "เทคโนโลยีสารสนเทศ", q: "โปรโตคอล (Protocol) คืออะไร?", options: ["ข้อตกลงหรือกฎเกณฑ์ในการสื่อสารข้อมูล", "อุปกรณ์สำหรับเชื่อมต่อเครือข่าย", "โปรแกรมสำหรับป้องกันไวรัส", "สายสัญญาณสำหรับเชื่อมต่ออินเทอร์เน็ต"], ans: 0 },
            { category: "เทคโนโลยีสารสนเทศ", q: "Big Data มีลักษณะสำคัญ 3V ยกเว้นข้อใด?", options: ["Volume (ปริมาณมาก)", "Visual (มีความสวยงาม)", "Velocity (เปลี่ยนแปลงรวดเร็ว)", "Variety (หลากหลายรูปแบบ)"], ans: 1 },
            { category: "เทคโนโลยีสารสนเทศ", q: "พระราชบัญญัติว่าด้วยการกระทำความผิดเกี่ยวกับคอมพิวเตอร์ มีไว้เพื่ออะไร?", options: ["ควบคุมราคาสินค้าคอมพิวเตอร์", "ส่งเสริมการขายซอฟต์แวร์ถูกลิขสิทธิ์", "กำหนดกฎเกณฑ์และบทลงโทษการใช้งานที่ผิด", "จำกัดเวลาการเล่นเกมของเยาวชน"], ans: 2 },
            { category: "เทคโนโลยีสารสนเทศ", q: "ข้อใดคือตัวอย่างของซอฟต์แวร์ระบบ (System Software)?", options: ["Microsoft Word", "Google Chrome", "Line", "Windows 10"], ans: 3 },

            // --- 4. นักวิเคราะห์ระบบและการพัฒนาระบบ (21-30) ---
            { category: "นักวิเคราะห์ระบบ", q: "หน้าที่หลักของ 'นักวิเคราะห์ระบบ (System Analyst)' คือ?", options: ["เป็นตัวกลางเชื่อมโยงระหว่างผู้ใช้และทีมพัฒนา", "เขียนโค้ดโปรแกรมทั้งหมดด้วยตนเอง", "ซ่อมคอมพิวเตอร์ให้กับพนักงานในบริษัท", "ขายอุปกรณ์คอมพิวเตอร์และอุปกรณ์ต่อพ่วง"], ans: 0 },
            { category: "นักวิเคราะห์ระบบ", q: "ทักษะด้านใดที่จำเป็นน้อยที่สุดสำหรับนักวิเคราะห์ระบบ?", options: ["ทักษะการสื่อสาร", "ทักษะการซ่อมประกอบคอมพิวเตอร์", "ทักษะการวิเคราะห์ปัญหา", "ทักษะด้านความรู้ธุรกิจ"], ans: 1 },
            { category: "นักวิเคราะห์ระบบ", q: "Feasibility Study คือการศึกษาเรื่องใด?", options: ["ความสวยงามของหน้าจอ", "จำนวนบรรทัดของโค้ดโปรแกรม", "ความเป็นไปได้ในการพัฒนาระบบ", "ยี่ห้อของเซิร์ฟเวอร์ที่จะใช้งาน"], ans: 2 },
            { category: "นักวิเคราะห์ระบบ", q: "เครื่องมือใดใช้ในการเก็บรวบรวมความต้องการ (Requirement Gathering)?", options: ["การสัมภาษณ์ (Interview)", "แบบสอบถาม (Questionnaire)", "การสังเกตการณ์ (Observation)", "ถูกทุกข้อ"], ans: 3 },
            { category: "นักวิเคราะห์ระบบ", q: "แผนภาพใดแสดงการไหลของข้อมูลภายในระบบ?", options: ["Data Flow Diagram (DFD)", "Flowchart", "ER-Diagram", "Use Case Diagram"], ans: 0 },
            { category: "นักวิเคราะห์ระบบ", q: "Functional Requirement เกี่ยวข้องกับสิ่งใด?", options: ["ความสวยงามของระบบ", "สิ่งที่ระบบ 'ต้องทำ' หรือหน้าที่ของระบบ", "ความเร็วในการประมวลผล", "ความปลอดภัยของระบบ"], ans: 1 },
            { category: "นักวิเคราะห์ระบบ", q: "Non-Functional Requirement คือ?", options: ["ฟังก์ชันสำหรับการคำนวณภาษีมูลค่าเพิ่ม", "ปุ่มกดสำหรับบันทึกข้อมูลลงฐานข้อมูล", "คุณสมบัติเชิงคุณภาพ เช่น ความปลอดภัย", "รายงานสรุปยอดขายประจำเดือนของบริษัท"], ans: 2 },
            { category: "นักวิเคราะห์ระบบ", q: "เอกสาร SRS (Software Requirement Specification) คือผลลัพธ์ของระยะใด?", options: ["Planning", "Design", "Testing", "Analysis"], ans: 3 },
            { category: "นักวิเคราะห์ระบบ", q: "Data Dictionary (พจนานุกรมข้อมูล) มีประโยชน์อย่างไร?", options: ["ใช้อธิบายโครงสร้างข้อมูลในระบบ", "ใช้แปลภาษาอังกฤษเป็นไทย", "ใช้ค้นหาเบอร์โทรศัพท์ลูกค้า", "ใช้ตรวจสอบคำผิดในโปรแกรม"], ans: 0 },
            { category: "นักวิเคราะห์ระบบ", q: "ข้อใด **ไม่ใช่** ประเภทของความเป็นไปได้ (Feasibility)?", options: ["Technical (ด้านเทคนิค)", "Emotional (ด้านอารมณ์)", "Operational (ด้านการปฏิบัติงาน)", "Economic (ด้านเศรษฐศาสตร์)"], ans: 1 },
            
            // --- 5. การสร้างคู่มือจากระบบที่พัฒนาขึ้น (31-35) ---
            { category: "คู่มือระบบ", q: "คู่มือผู้ใช้ (User Manual) จัดทำขึ้นเพื่อใคร?", options: ["โปรแกรมเมอร์", "ผู้ดูแลระบบเครือข่าย", "ผู้ใช้งานระบบปลายทาง", "นักวิเคราะห์ระบบ"], ans: 2 },
            { category: "คู่มือระบบ", q: "เนื้อหาในคู่มือเทคนิค (Technical Manual) ควรประกอบด้วย?", options: ["วิธีการล็อกอินเข้าระบบ", "วิธีการพิมพ์รายงาน", "ภาพหน้าจอการใช้งาน", "ผังโครงสร้างฐานข้อมูล (ERD)"], ans: 3 },
            { category: "คู่มือระบบ", q: "ข้อใดคือลักษณะของคู่มือที่ดี?", options: ["ใช้ภาษาเข้าใจง่าย มีภาพประกอบ", "ใช้ศัพท์เทคนิคให้มากที่สุด", "มีแต่ตัวหนังสือ ไม่มีรูปภาพ", "มีความยาวไม่ต่ำกว่า 500 หน้า"], ans: 0 },
            { category: "คู่มือระบบ", q: "การอบรม (Training) ผู้ใช้งาน ควรทำในช่วงใด?", options: ["ก่อนเริ่มวิเคราะห์ระบบ", "เมื่อติดตั้งระบบและก่อนใช้งานจริง", "ระหว่างเขียนโปรแกรม", "หลังจากใช้งานระบบไปแล้ว 1 ปี"], ans: 1 },
            { category: "คู่มือระบบ", q: "หากมีการอัปเดตระบบเวอร์ชันใหม่ สิ่งที่ควรทำกับคู่มือคือ?", options: ["ใช้คู่มือเดิมต่อไป", "ทิ้งคู่มือเดิมแล้วให้เรียนรู้เอง", "ปรับปรุงคู่มือให้ตรงกับปัจจุบัน", "เขียนคู่มือใหม่เป็นภาษาอังกฤษ"], ans: 2 },
            
            // --- 6. วงจรการพัฒนาระบบ (SDLC) (36-42) ---
            { category: "SDLC", q: "SDLC ย่อมาจากอะไร?", options: ["System Design Logic Code", "System Data Life Circle", "Standard Development Low Cost", "Software Development Life Cycle"], ans: 3 },
            { category: "SDLC", q: "ขั้นตอนแรกสุดของ SDLC คือข้อใด?", options: ["Planning (วางแผน)", "Analysis (วิเคราะห์)", "Design (ออกแบบ)", "Implementation (พัฒนาระบบ)"], ans: 0 },
            { category: "SDLC", q: "ในระยะ Design (ออกแบบ) สิ่งที่ได้เป็นผลลัพธ์คือ?", options: ["Source Code", "System Specification (แบบจำลองระบบ)", "User Manual", "Problem Statement"], ans: 1 },
            { category: "SDLC", q: "การเขียนโปรแกรม (Coding) อยู่ในขั้นตอนใดของ SDLC?", options: ["System Analysis", "System Design", "Implementation", "Maintenance"], ans: 2 },
            { category: "SDLC", q: "การทดสอบระบบ (Testing) มีวัตถุประสงค์หลักเพื่อ?", options: ["จับผิดการทำงานของโปรแกรมเมอร์", "ทำให้ระบบทำงานช้าลงเพื่อทดสอบ", "เพิ่มงบประมาณของโครงการ", "หาข้อผิดพลาด (Bug) เพื่อแก้ไข"], ans: 3 },
            { category: "SDLC", q: "ขั้นตอนใดเกิดขึ้นหลังจากระบบถูกนำไปใช้งานจริงแล้ว?", options: ["Maintenance (บำรุงรักษา)", "Feasibility Study", "Requirement Gathering", "Prototyping"], ans: 0 },
            { category: "SDLC", q: "Unit Testing คือการทดสอบแบบใด?", options: ["ทดสอบภาพรวมทั้งระบบ", "ทดสอบการทำงานทีละโมดูลย่อย", "ทดสอบโดยผู้ใช้งานจริง", "ทดสอบระบบความปลอดภัย"], ans: 1 },
            
            // --- 7. Waterfall Model (43-44) ---
            { category: "Waterfall Model", q: "ข้อใดคือลักษณะเด่นของ Waterfall Model?", options: ["ทำงานวนเป็นวงกลม", "แบ่งงานเป็นส่วนเล็กๆ ทำซ้ำๆ", "ทำทีละขั้นตอนแบบน้ำตกไหลลง", "เน้นการสร้างตัวต้นแบบ"], ans: 2 },
            { category: "Waterfall Model", q: "Waterfall Model เหมาะกับโครงการแบบใด?", options: ["โครงการที่มีความต้องการไม่แน่นอน", "โครงการที่ต้องการความรวดเร็วสูง", "โครงการทดลองวิจัย", "โครงการที่ความต้องการชัดเจนไม่เปลี่ยนบ่อย"], ans: 3 },
            
            // --- 8. Evolutionary Model (45-46) ---
            { category: "Evolutionary Model", q: "Evolutionary Model มักใช้วิธีการใดในการพัฒนา?", options: ["สร้างต้นแบบให้ผู้ใช้เห็นและปรับปรุงไปเรื่อยๆ", "วางแผนการทำงานทั้งหมดให้เสร็จในครั้งเดียว", "เขียนคู่มือการใช้งานก่อนเริ่มเขียนโปรแกรม", "เน้นการพัฒนาโปรแกรมโดยไม่ต้องมีการทดสอบ"], ans: 0 },
            { category: "Evolutionary Model", q: "ข้อดีของรูปแบบวิวัฒนาการคือ?", options: ["ใช้เอกสารน้อยที่สุด", "ผู้ใช้ได้เห็นรูปร่างหน้าตาของระบบตั้งแต่เนิ่นๆ", "ค่าใช้จ่ายต่ำที่สุด", "ใช้เวลาน้อยที่สุด"], ans: 1 },
            
            // --- 9. Incremental Model (47-48) ---
            { category: "Incremental Model", q: "แนวคิดหลักของ Incremental Model คือ?", options: ["พัฒนาระบบทั้งหมดให้เสร็จสมบูรณ์ในครั้งเดียว", "เน้นการจัดทำเอกสารให้ครบถ้วนก่อนเริ่มงาน", "แบ่งระบบเป็นส่วนย่อยและทยอยส่งมอบทีละส่วน", "พัฒนาโปรแกรมไปเรื่อยๆ โดยไม่มีการวางแผน"], ans: 2 },
            { category: "Incremental Model", q: "ความแตกต่างระหว่าง Waterfall และ Incremental คือ?", options: ["Waterfall ใช้บุคลากรในการทำงานจำนวนมากกว่า", "Incremental ไม่มีการออกแบบระบบก่อนเริ่มทำ", "Waterfall ไม่มีการทดสอบระบบก่อนส่งมอบงาน", "Incremental ส่งมอบงานเป็นส่วนๆ ได้เร็วกว่า"], ans: 3 },
            
            // --- 10. Spiral Model (49-50) ---
            { category: "Spiral Model", q: "จุดเด่นสำคัญที่สุดของ Spiral Model คือการเน้นเรื่องใด?", options: ["การวิเคราะห์ความเสี่ยง (Risk Analysis)", "ความสวยงาม", "ความเร็ว", "การประหยัดงบประมาณ"], ans: 0 },
            { category: "Spiral Model", q: "Spiral Model มีลักษณะการทำงานแบบใด?", options: ["เส้นตรงจากบนลงล่าง", "วนเป็นเกลียว ทำซ้ำและขยายขอบเขตไปเรื่อยๆ", "สุ่มทำขั้นตอนต่างๆ", "ทำครั้งเดียวจบ"], ans: 1 },
            
            // --- 11. ER-Diagram (51-60) ---
            { category: "ER-Diagram", q: "ER-Diagram (Entity-Relationship Diagram) ใช้สำหรับทำอะไร?", options: ["ออกแบบหน้าจอโปรแกรม", "ออกแบบระบบเครือข่าย", "ออกแบบโครงสร้างฐานข้อมูล", "ออกแบบอัลกอริทึม"], ans: 2 },
            { category: "ER-Diagram", q: "สัญลักษณ์ 'สี่เหลี่ยมผืนผ้า (Rectangle)' ใน ER-Diagram แทนสิ่งใด?", options: ["Attribute (คุณลักษณะ)", "Relationship (ความสัมพันธ์)", "Process (กระบวนการ)", "Entity (เอนทิตี)"], ans: 3 },
            { category: "ER-Diagram", q: "สัญลักษณ์ 'วงรี (Oval)' ใน ER-Diagram แทนสิ่งใด?", options: ["Attribute", "Entity", "Key", "Action"], ans: 0 },
            { category: "ER-Diagram", q: "สัญลักษณ์ 'สี่เหลี่ยมขนมเปียกปูน (Diamond)' แทนสิ่งใด?", options: ["จุดเริ่มต้น", "ความสัมพันธ์ (Relationship)", "การตัดสินใจ", "ฐานข้อมูล"], ans: 1 },
            { category: "ER-Diagram", q: "Primary Key (คีย์หลัก) คืออะไร?", options: ["คีย์สำหรับล็อกประตูห้อง", "Attribute ที่ใช้เชื่อมโยงไปยังตารางอื่น", "Attribute ที่ระบุความแตกต่างของข้อมูล (ห้ามซ้ำ)", "ข้อมูลที่ต้องเป็นตัวเลขจำนวนเต็มเท่านั้น"], ans: 2 },
            { category: "ER-Diagram", q: "Foreign Key (คีย์นอก) มีหน้าที่อะไร?", options: ["เป็นคีย์หลักของตาราง", "ใช้เก็บรหัสผ่าน", "ใช้เก็บรูปภาพ", "ใช้เชื่อมโยงความสัมพันธ์ไปยัง Primary Key ของอีกตาราง"], ans: 3 },
            { category: "ER-Diagram", q: "ความสัมพันธ์แบบ 1:N (One-to-Many) หมายถึง?", options: ["หนึ่งรายการใน A สัมพันธ์กับหลายรายการใน B", "หนึ่งรายการใน A สัมพันธ์กับหนึ่งรายการใน B", "หลายรายการใน A สัมพันธ์กับหลายรายการใน B", "ข้อมูลใน A และ B ไม่มีความสัมพันธ์กันเลย"], ans: 0 },
            { category: "ER-Diagram", q: "ความสัมพันธ์แบบ M:N (Many-to-Many) ในทางปฏิบัติควรทำอย่างไร?", options: ["ปล่อยข้อมูลไว้แบบนั้นไม่ต้องแก้ไข", "สร้างตารางเชื่อมเพื่อแปลงเป็นแบบ 1:N", "ลบข้อมูลที่มีความซับซ้อนทิ้งไป", "เปลี่ยนไปใช้ระบบจัดการฐานข้อมูลอื่น"], ans: 1 },
            { category: "ER-Diagram", q: "การขีดเส้นใต้ (Underline) ชื่อ Attribute ใน ER-Diagram หมายความว่า?", options: ["เป็นข้อมูลสำคัญ", "เป็นข้อมูลตัวเลข", "เป็น Primary Key", "เป็นค่าว่างได้"], ans: 2 },
            { category: "ER-Diagram", q: "Cardinality Ratio คืออะไร?", options: ["ขนาดของฐานข้อมูล", "จำนวนตารางทั้งหมด", "ความเร็วในการค้นหา", "อัตราส่วนความสัมพันธ์ระหว่าง Entity"], ans: 3 }
        ];

        // State
        let currentQuestionIndex = 0;
        let userAnswers = new Array(quizData.length).fill(null);
        let timerInterval;
        let startTime;
        let studentInfo = {};

        // Elements
        const startScreen = document.getElementById('start-screen');
        const questionScreen = document.getElementById('question-screen');
        const resultScreen = document.getElementById('result-screen');
        const questionText = document.getElementById('question-text');
        const questionCategory = document.getElementById('question-category');
        const currentQNum = document.getElementById('current-q-num');
        const choicesContainer = document.getElementById('choices-container');
        const navGrid = document.getElementById('nav-grid');
        const btnPrev = document.getElementById('btn-prev');
        const btnNext = document.getElementById('btn-next');
        const btnSubmit = document.getElementById('btn-submit');
        const timerDisplay = document.getElementById('timer');
        const scoreDisplay = document.getElementById('score-display');
        const scorePercent = document.getElementById('score-percent');
        const sidebar = document.getElementById('sidebar');

        // Initial Setup
        function init() {
            renderNav();
        }

        // Custom Modal Function
        function showModal(title, message, hasCancel, onConfirm) {
            const modal = document.getElementById('custom-modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            
            const btnCancel = document.getElementById('modal-cancel');
            const btnConfirm = document.getElementById('modal-confirm');
            
            if (hasCancel) {
                btnCancel.classList.remove('hidden');
                btnCancel.onclick = () => {
                    modal.classList.add('hidden');
                };
            } else {
                btnCancel.classList.add('hidden');
            }
            
            btnConfirm.onclick = () => {
                modal.classList.add('hidden');
                if (onConfirm) onConfirm();
            };
            
            modal.classList.remove('hidden');
        }

        function startQuiz() {
            // Validation
            const name = document.getElementById('student-name').value.trim();
            const cls = document.getElementById('student-class').value;
            const num = document.getElementById('student-number').value.trim();

            if (!name || !cls || !num) {
                // Use Custom Modal instead of alert
                showModal("ข้อมูลไม่ครบถ้วน", "กรุณากรอกข้อมูลให้ครบถ้วน (ชื่อ-สกุล, ระดับชั้น, และเลขที่)", false);
                return;
            }

            studentInfo = { name, cls, num };

            startScreen.classList.add('hidden');
            questionScreen.classList.remove('hidden');
            sidebar.classList.remove('hidden');
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            loadQuestion(0);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const m = Math.floor(elapsed / 60).toString().padStart(2, '0');
            const s = (elapsed % 60).toString().padStart(2, '0');
            timerDisplay.textContent = `${m}:${s}`;
        }

        function loadQuestion(index) {
            currentQuestionIndex = index;
            const data = quizData[index];

            // Removed Animation Reset to prevent blinking

            // Update UI Text
            questionText.innerHTML = data.q.replace(/\*\*(.*?)\*\*/g, '<span class="text-blue-600 font-bold">$1</span>'); // Highlight text
            questionCategory.textContent = data.category;
            currentQNum.textContent = index + 1;

            // Update Nav Active State
            document.querySelectorAll('.nav-btn').forEach((btn, idx) => {
                if (idx === index) {
                    btn.classList.add('ring-2', 'ring-blue-500', 'z-10', 'bg-blue-50', 'text-blue-700', 'border-blue-200');
                    btn.classList.remove('text-gray-600', 'bg-white');
                } else {
                    btn.classList.remove('ring-2', 'ring-blue-500', 'z-10', 'bg-blue-50', 'text-blue-700', 'border-blue-200');
                    if (userAnswers[idx] === null) {
                         btn.classList.add('text-gray-500', 'bg-white');
                    }
                }
            });

            // Render Choices
            choicesContainer.innerHTML = '';
            data.options.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = `choice-btn w-full text-left p-4 rounded-xl border border-slate-200 transition-all duration-200 flex items-center gap-4 bg-white hover:bg-slate-50 relative group`;
                
                // Add label (ก, ข, ค, ง)
                const labels = ['ก.', 'ข.', 'ค.', 'ง.'];
                btn.innerHTML = `
                    <span class="flex-shrink-0 w-8 h-8 flex items-center justify-center rounded-lg bg-slate-100 text-slate-500 font-bold text-sm group-hover:bg-blue-100 group-hover:text-blue-600 transition-colors">${labels[idx]}</span> 
                    <span class="text-slate-700 font-medium group-hover:text-slate-900">${opt}</span>
                    <div class="absolute right-4 w-4 h-4 rounded-full border-2 border-slate-200 group-hover:border-blue-400"></div>
                `;

                if (userAnswers[index] === idx) {
                    btn.classList.add('selected');
                    // Change inner circle
                    btn.querySelector('div:last-child').classList.remove('border-slate-200');
                    btn.querySelector('div:last-child').classList.add('bg-blue-500', 'border-blue-500');
                }

                btn.onclick = () => selectAnswer(index, idx);
                choicesContainer.appendChild(btn);
            });

            // Button States
            btnPrev.disabled = index === 0;
            if (index === quizData.length - 1) {
                btnNext.classList.add('hidden');
                btnSubmit.classList.remove('hidden');
            } else {
                btnNext.classList.remove('hidden');
                btnSubmit.classList.add('hidden');
            }
        }

        function selectAnswer(qIndex, choiceIndex) {
            userAnswers[qIndex] = choiceIndex;
            loadQuestion(qIndex); // Re-render to show selection
            updateNavStatus(qIndex);
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) loadQuestion(currentQuestionIndex - 1);
        }

        function nextQuestion() {
            if (currentQuestionIndex < quizData.length - 1) loadQuestion(currentQuestionIndex + 1);
        }

        function jumpToQuestion(index) {
            loadQuestion(index);
            // On mobile, close sidebar after jump
            if(window.innerWidth < 768) {
                sidebar.classList.add('hidden');
            }
        }

        function renderNav() {
            navGrid.innerHTML = '';
            quizData.forEach((_, idx) => {
                const btn = document.createElement('button');
                btn.className = `nav-btn w-full h-8 md:h-10 text-xs font-semibold border border-slate-200 rounded-lg flex items-center justify-center bg-white text-slate-400 hover:bg-slate-50 transition-all`;
                btn.textContent = idx + 1;
                btn.onclick = () => jumpToQuestion(idx);
                btn.id = `nav-${idx}`;
                navGrid.appendChild(btn);
            });
        }

        function updateNavStatus(index) {
            const btn = document.getElementById(`nav-${index}`);
            if (userAnswers[index] !== null) {
                btn.classList.remove('bg-white', 'text-slate-400', 'border-slate-200');
                btn.classList.add('bg-blue-500', 'text-white', 'border-blue-500', 'shadow-md', 'shadow-blue-500/30');
            }
        }

        function submitQuiz() {
            const unanswered = userAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                // Use Custom Modal instead of confirm
                showModal("ยืนยันการส่งคำตอบ", `คุณยังทำไม่ครบ ${unanswered} ข้อ ต้องการส่งคำตอบเลยหรือไม่?`, true, () => {
                    processSubmission();
                });
            } else {
                processSubmission();
            }
        }

        function processSubmission() {
            clearInterval(timerInterval);
            calculateScore();
            questionScreen.classList.add('hidden');
            sidebar.classList.add('hidden');
            resultScreen.classList.remove('hidden');
        }

        function calculateScore() {
            let score = 0;
            userAnswers.forEach((ans, idx) => {
                if (ans === quizData[idx].ans) score++;
            });
            
            const percent = Math.round((score / 60) * 100);

            // Animation: Count Up Score
            const duration = 2000; // ระยะเวลา 2 วินาที
            const startTimestamp = performance.now();
            
            function step(timestamp) {
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                // ใช้ Easing function แบบ easeOutExpo ให้ตอนท้ายช้าลง ลุ้นๆ
                const easeProgress = progress === 1 ? 1 : 1 - Math.pow(2, -10 * progress);
                
                const currentScore = Math.floor(easeProgress * score);
                const currentPercent = Math.round((currentScore / 60) * 100);

                scoreDisplay.textContent = `${currentScore} / 60`;
                scorePercent.textContent = `คะแนนคิดเป็น ${currentPercent}%`;

                if (progress < 1) {
                    requestAnimationFrame(step);
                } else {
                    // จบการทำงาน ตั้งค่าให้ตรงเป๊ะกันเหนียว
                    scoreDisplay.textContent = `${score} / 60`;
                    scorePercent.textContent = `คะแนนคิดเป็น ${percent}%`;
                }
            }
            
            requestAnimationFrame(step);

            // Display Student Info on Result Screen
            document.getElementById('result-student-info').innerHTML = `
                <div class="flex justify-between border-b border-dashed border-slate-200 pb-1 mb-1">
                    <span class="text-slate-500 text-sm">ชื่อ-สกุล:</span>
                    <span class="font-bold text-slate-800">${studentInfo.name}</span>
                </div>
                <div class="flex justify-between border-b border-dashed border-slate-200 pb-1 mb-1">
                    <span class="text-slate-500 text-sm">ระดับชั้น:</span>
                    <span class="font-medium text-slate-800">${studentInfo.cls}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-500 text-sm">เลขที่:</span>
                    <span class="font-medium text-slate-800">${studentInfo.num}</span>
                </div>
            `;

            // Send to Google Sheet
            if (GOOGLE_SCRIPT_URL && GOOGLE_SCRIPT_URL.startsWith('http')) {
                sendScoreToGoogleSheet(score, percent);
            } else {
                 document.getElementById('save-status').innerHTML = `<span class="text-amber-500">⚠ ไม่ได้เชื่อมต่อ Google Sheet หรือ URL ไม่ถูกต้อง</span>`;
            }
        }

        function sendScoreToGoogleSheet(score, percent) {
            const statusDiv = document.getElementById('save-status');
            statusDiv.innerHTML = `<span class="text-blue-500 animate-pulse">กำลังบันทึกคะแนน...</span>`;

            const payload = {
                name: studentInfo.name,
                cls: studentInfo.cls,
                num: studentInfo.num,
                total: 60,
                score: score,
                percent: percent + "%"
            };

            console.log("Sending payload to:", GOOGLE_SCRIPT_URL);

            // Using no-cors mode for Google Apps Script Web App
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', 
                headers: {
                    "Content-Type": "text/plain;charset=utf-8", // Sometimes helps GAS parse correctly
                },
                body: JSON.stringify(payload)
            })
            .then(() => {
                // Since 'no-cors' returns an opaque response, we assume success if no error is thrown
                statusDiv.innerHTML = `<span class="text-green-600 font-bold">✅ บันทึกคะแนนเรียบร้อยแล้ว</span>`;
            })
            .catch(error => {
                console.error('Error:', error);
                statusDiv.innerHTML = `<span class="text-red-500">❌ เกิดข้อผิดพลาดในการบันทึกคะแนน (กรุณาตรวจสอบ Console)</span>`;
            });
        }

        function toggleSidebar() {
            sidebar.classList.toggle('hidden');
        }

        init();

    </script>
</body>
</html>